# API Reference

This document provides a comprehensive reference for all GraphQL queries, mutations, and types generated by the Django GraphQL Auto-Generation Library.

## üìö Table of Contents

- [Overview](#overview)
- [Query Operations](#query-operations)
- [Mutation Operations](#mutation-operations)
- [Method Mutations](#method-mutations)
- [Bulk Operations](#bulk-operations)
- [Performance Optimization APIs](#performance-optimization-apis)
- [Input Types](#input-types)
- [Output Types](#output-types)
- [Filter Types](#filter-types)
- [Scalar Types](#scalar-types)
- [Error Handling](#error-handling)
- [Examples](#examples)

## üîç Overview

The Django GraphQL Auto-Generation Library automatically creates a comprehensive GraphQL API from your Django models. This reference documents all generated operations and types.

### Generated Schema Structure

```graphql
schema {
  query: Query
  mutation: Mutation
}

type Query {
  # Single object queries
  <model>(id: ID!): <Model>Type
  
  # List queries with filtering
  <models>(filters: <Model>FilterInput, orderBy: [String], limit: Int, offset: Int): [<Model>Type]
  
  # Paginated queries
  <model>Pages(first: Int, after: String, filters: <Model>FilterInput): <Model>Connection
}

type Mutation {
  # CRUD operations
  create<Model>(input: Create<Model>Input!): Create<Model>Payload
  update<Model>(input: Update<Model>Input!): Update<Model>Payload
  delete<Model>(id: ID!): Delete<Model>Payload
  
  # Method mutations (when enabled)
  <model><Method>(id: ID!, ...args): <Model><Method>Payload
  
  # Bulk operations (when enabled)
  bulkCreate<Model>(input: BulkCreate<Model>Input!): BulkCreate<Model>Payload
  bulkUpdate<Model>(input: BulkUpdate<Model>Input!): BulkUpdate<Model>Payload
  bulkDelete<Model>(input: BulkDelete<Model>Input!): BulkDelete<Model>Payload
}
```

## üîç Query Operations

### Single Object Queries

Retrieve a single object by its ID.

#### Syntax
```graphql
<model>(id: ID!): <Model>Type
```

#### Example
```graphql
query GetPost($id: ID!) {
  post(id: $id) {
    id
    title
    content
    published
    author {
      id
      username
      email
    }
    tags {
      id
      name
    }
  }
}
```

#### Variables
```json
{
  "id": "1"
}
```

### List Queries

Retrieve multiple objects with optional filtering, ordering, and pagination.

#### Syntax
```graphql
<models>(
  filters: <Model>FilterInput
  orderBy: [String]
  limit: Int
  offset: Int
): [<Model>Type]
```

#### Parameters

| Parameter | Type | Description |
|-----------|------|-------------|
| `filters` | `<Model>FilterInput` | Filter criteria for the query |
| `orderBy` | `[String]` | Field names for ordering (prefix with `-` for descending) |
| `limit` | `Int` | Maximum number of objects to return |
| `offset` | `Int` | Number of objects to skip |

#### Example
```graphql
query GetPosts($filters: PostFilterInput, $orderBy: [String], $limit: Int) {
  posts(filters: $filters, orderBy: $orderBy, limit: $limit) {
    id
    title
    published
    createdAt
    author {
      username
    }
  }
}
```

#### Variables
```json
{
  "filters": {
    "published": true,
    "title__icontains": "django",
    "author__username": "john_doe"
  },
  "orderBy": ["-createdAt", "title"],
  "limit": 10
}
```

### Paginated Queries

Retrieve objects using cursor-based pagination (Relay-style).

#### Syntax
```graphql
<model>Pages(
  first: Int
  after: String
  last: Int
  before: String
  filters: <Model>FilterInput
): <Model>Connection
```

#### Example
```graphql
query GetPostPages($first: Int, $after: String, $filters: PostFilterInput) {
  postPages(first: $first, after: $after, filters: $filters) {
    edges {
      node {
        id
        title
        author {
          username
        }
      }
      cursor
    }
    pageInfo {
      hasNextPage
      hasPreviousPage
      startCursor
      endCursor
    }
    totalCount
  }
}
```

## ‚úèÔ∏è Mutation Operations

### Create Mutations

Create a new object.

#### Syntax
```graphql
create<Model>(input: Create<Model>Input!): Create<Model>Payload
```

#### Example
```graphql
mutation CreatePost($input: CreatePostInput!) {
  createPost(input: $input) {
    ok
    post {
      id
      title
      author {
        username
      }
    }
    errors
  }
}
```

#### Variables
```json
{
  "input": {
    "title": "My New Post",
    "content": "This is the content of my post...",
    "published": false,
    "authorId": "1",
    "tagIds": ["1", "2", "3"]
  }
}
```

### Update Mutations

Update an existing object.

#### Syntax
```graphql
update<Model>(input: Update<Model>Input!): Update<Model>Payload
```

#### Example
```graphql
mutation UpdatePost($input: UpdatePostInput!) {
  updatePost(input: $input) {
    ok
    post {
      id
      title
      published
      updatedAt
    }
    errors
  }
}
```

#### Variables
```json
{
  "input": {
    "id": "1",
    "title": "Updated Post Title",
    "published": true
  }
}
```

### Delete Mutations

Delete an existing object.

#### Syntax
```graphql
delete<Model>(id: ID!): Delete<Model>Payload
```

#### Example
```graphql
mutation DeletePost($id: ID!) {
  deletePost(id: $id) {
    ok
    deletedId
    errors
  }
}
```

#### Variables
```json
{
  "id": "1"
}
```

## üéØ Method Mutations

Execute custom model methods as GraphQL mutations.

### Syntax
```graphql
<model><Method>(id: ID!, ...methodArgs): <Model><Method>Payload
```

### Configuration

Enable method mutations in your Django model:

```python
from django_graphql_auto.decorators import graphql_mutation

class Post(models.Model):
    title = models.CharField(max_length=200, verbose_name="Titre du post")
    published = models.BooleanField(default=False, verbose_name="Publi√©")
    
    @graphql_mutation
    def publish_post(self):
        """Publier le post."""
        self.published = True
        self.save()
        return True
    
    @graphql_mutation
    def archive_post(self, reason: str = "No reason provided"):
        """Archiver le post avec une raison."""
        self.archived = True
        self.archive_reason = reason
        self.save()
        return {"archived": True, "reason": reason}
```

### Generated Mutations

```graphql
type Mutation {
  postPublishPost(id: ID!): PostPublishPostPayload
  postArchivePost(id: ID!, reason: String): PostArchivePostPayload
}
```

### Example Usage

```graphql
mutation PublishPost($id: ID!) {
  postPublishPost(id: $id) {
    ok
    post {
      id
      title
      published
    }
    result  # Method return value
    errors
  }
}

mutation ArchivePost($id: ID!, $reason: String!) {
  postArchivePost(id: $id, reason: $reason) {
    ok
    post {
      id
      title
      archived
      archiveReason
    }
    result  # Method return value
    errors
  }
}
```

## üì¶ Bulk Operations

Perform operations on multiple objects efficiently.

### Bulk Create

Create multiple objects in a single operation.

#### Syntax
```graphql
bulkCreate<Model>(input: BulkCreate<Model>Input!): BulkCreate<Model>Payload
```

#### Example
```graphql
mutation BulkCreatePosts($input: BulkCreatePostInput!) {
  bulkCreatePost(input: $input) {
    ok
    objects {
      id
      title
      author {
        username
      }
    }
    errors
  }
}
```

#### Variables
```json
{
  "input": {
    "objects": [
      {
        "title": "Post 1",
        "content": "Content 1...",
        "authorId": "1"
      },
      {
        "title": "Post 2",
        "content": "Content 2...",
        "authorId": "2"
      }
    ]
  }
}
```

### Bulk Update

Update multiple objects with different values.

#### Syntax
```graphql
bulkUpdate<Model>(input: BulkUpdate<Model>Input!): BulkUpdate<Model>Payload
```

#### Example
```graphql
mutation BulkUpdatePosts($input: BulkUpdatePostInput!) {
  bulkUpdatePost(input: $input) {
    ok
    objects {
      id
      title
      published
    }
    errors
  }
}
```

#### Variables
```json
{
  "input": {
    "objects": [
      {
        "id": "1",
        "published": true
      },
      {
        "id": "2",
        "title": "Updated Title"
      }
    ]
  }
}
```

### Bulk Delete

Delete multiple objects by their IDs.

#### Syntax
```graphql
bulkDelete<Model>(input: BulkDelete<Model>Input!): BulkDelete<Model>Payload
```

#### Example
```graphql
mutation BulkDeletePosts($input: BulkDeletePostInput!) {
  bulkDeletePost(input: $input) {
    ok
    deletedIds
    errors
  }
}
```

#### Variables
```json
{
  "input": {
    "ids": ["1", "2", "3", "4"]
  }
}
```

## üìù Input Types

### Create Input Types

Input types for creating new objects.

```graphql
input Create<Model>Input {
  # All model fields except auto-generated ones
  <field>: <FieldType>
  
  # Foreign key relationships
  <foreignKey>Id: ID
  
  # Many-to-many relationships
  <manyToMany>Ids: [ID]
  
  # Nested object creation (when enabled)
  <foreignKey>: Create<RelatedModel>Input
  <manyToMany>: [Create<RelatedModel>Input]
}
```

### Update Input Types

Input types for updating existing objects.

```graphql
input Update<Model>Input {
  id: ID!  # Required for updates
  
  # All model fields (optional for updates)
  <field>: <FieldType>
  
  # Relationship updates
  <foreignKey>Id: ID
  <manyToMany>Ids: [ID]
}
```

### Bulk Input Types

Input types for bulk operations.

```graphql
input BulkCreate<Model>Input {
  objects: [Create<Model>Input!]!
}

input BulkUpdate<Model>Input {
  objects: [Update<Model>Input!]!
}

input BulkDelete<Model>Input {
  ids: [ID!]!
}
```

## ‚ö° Performance Optimization APIs

The Django GraphQL Auto-Generation Library includes comprehensive performance optimization APIs for N+1 query prevention, caching, and performance monitoring.

### Query Optimization Decorators

#### @optimize_query

Automatically optimizes database queries to prevent N+1 problems.

```python
from django_graphql_auto import optimize_query

class Author(models.Model):
    name = models.CharField(max_length=100)
    
    @optimize_query
    def get_recent_posts(self):
        """Obtenir les posts r√©cents (Get recent posts)"""
        return self.posts.filter(created_at__gte=timezone.now() - timedelta(days=30))
```

#### @cache_query

Caches query results for improved performance.

```python
from django_graphql_auto import cache_query

class Category(models.Model):
    name = models.CharField(max_length=100)
    
    @cache_query(ttl=300)  # Cache for 5 minutes
    def get_post_count(self):
        """Obtenir le nombre de posts (Get post count)"""
        return self.posts.filter(published=True).count()
```

### Performance Monitoring Query

Access real-time performance metrics through GraphQL.

```graphql
query PerformanceMetrics {
  __performance {
    queryCount          # Number of database queries executed
    executionTime       # Total execution time in milliseconds
    cacheHits          # Number of cache hits
    cacheMisses        # Number of cache misses
    optimizedQueries   # Number of automatically optimized queries
    complexityScore    # Query complexity score
  }
}
```

### Cache Management APIs

#### Schema-Level Caching

```python
from django_graphql_auto import GraphQLCacheManager

cache_manager = GraphQLCacheManager()

# Cache schema
cache_manager.cache_schema('my_app', schema_data, ttl=3600)

# Get cached schema
cached_schema = cache_manager.get_cached_schema('my_app')

# Invalidate schema cache
cache_manager.invalidate_schema_cache('my_app')
```

#### Query-Level Caching

```python
# Cache query result
cache_manager.cache_query_result(query_hash, result, ttl=300)

# Get cached query result
cached_result = cache_manager.get_cached_query_result(query_hash)

# Invalidate query cache
cache_manager.invalidate_query_cache(query_hash)
```

#### Field-Level Caching

```python
# Cache field result
cache_manager.cache_field_result(field_key, result, ttl=600)

# Get cached field result
cached_field = cache_manager.get_cached_field_result(field_key)
```

### Performance Configuration

Configure performance optimization in Django settings:

```python
DJANGO_GRAPHQL_AUTO = {
    'PERFORMANCE': {
        'ENABLE_QUERY_OPTIMIZATION': True,
        'ENABLE_CACHING': True,
        'ENABLE_PERFORMANCE_MONITORING': True,
        'CACHE_BACKEND': 'redis',
        'CACHE_TTL': 300,
        'MAX_QUERY_COMPLEXITY': 1000,
        'ENABLE_QUERY_ANALYSIS': True,
        'OPTIMIZATION_LEVEL': 'aggressive',  # conservative, balanced, aggressive
        'PREFETCH_RELATED_DEPTH': 3,
        'SELECT_RELATED_DEPTH': 2,
    }
}
```

### Performance Middleware

Enable performance monitoring middleware:

```python
# urls.py
from django_graphql_auto.middleware import setup_performance_monitoring

setup_performance_monitoring()

urlpatterns = [
    path('graphql/', GraphQLView.as_view(graphiql=True)),
    path('graphql/performance/', include('django_graphql_auto.urls')),
]
```

### Benchmarking Commands

Run performance benchmarks via Django management commands:

```bash
# Run all performance tests
python manage.py run_performance_benchmarks --test-type all

# Run specific test types
python manage.py run_performance_benchmarks --test-type n1 --data-size 1000

# Run caching tests
python manage.py run_performance_benchmarks --test-type caching --cache-scenarios all

# Run load tests
python manage.py run_performance_benchmarks --test-type load --concurrent-users 50

# Generate detailed reports
python manage.py run_performance_benchmarks --output-dir reports/ --format json,csv,html
```

### Performance Analysis APIs

#### QueryOptimizer

```python
from django_graphql_auto.optimization import QueryOptimizer

optimizer = QueryOptimizer()

# Analyze query for optimization opportunities
analysis = optimizer.analyze_query(query_string, variables)

# Apply automatic optimizations
optimized_query = optimizer.optimize_query(query_string, model_info)

# Get optimization suggestions
suggestions = optimizer.get_optimization_suggestions(query_analysis)
```

#### PerformanceMonitor

```python
from django_graphql_auto.performance import PerformanceMonitor

monitor = PerformanceMonitor()

# Start monitoring a query
monitor.start_query_monitoring(query_id)

# Record query metrics
monitor.record_query_metrics(query_id, execution_time, db_queries)

# Get performance summary
summary = monitor.get_performance_summary(time_range='1h')

# Set performance alerts
monitor.set_alert_threshold('query_time', 1000)  # 1 second
monitor.set_alert_threshold('db_queries', 10)
```

## üì§ Output Types

### Standard Payload Types

All mutations return payload types with consistent structure.

```graphql
type Create<Model>Payload {
  ok: Boolean!
  <model>: <Model>Type
  errors: [String]
}

type Update<Model>Payload {
  ok: Boolean!
  <model>: <Model>Type
  errors: [String]
}

type Delete<Model>Payload {
  ok: Boolean!
  deletedId: ID
  errors: [String]
}
```

### Method Mutation Payload Types

Method mutations include the method's return value.

```graphql
type <Model><Method>Payload {
  ok: Boolean!
  <model>: <Model>Type
  result: <MethodReturnType>  # Method return value
  errors: [String]
}
```

### Bulk Operation Payload Types

Bulk operations return arrays of objects or IDs.

```graphql
type BulkCreate<Model>Payload {
  ok: Boolean!
  objects: [<Model>Type]
  errors: [String]
}

type BulkUpdate<Model>Payload {
  ok: Boolean!
  objects: [<Model>Type]
  errors: [String]
}

type BulkDelete<Model>Payload {
  ok: Boolean!
  deletedIds: [ID]
  errors: [String]
}
```

### Connection Types

Paginated queries return connection types following Relay specification.

```graphql
type <Model>Connection {
  edges: [<Model>Edge]
  pageInfo: PageInfo!
  totalCount: Int
}

type <Model>Edge {
  node: <Model>Type
  cursor: String!
}

type PageInfo {
  hasNextPage: Boolean!
  hasPreviousPage: Boolean!
  startCursor: String
  endCursor: String
}
```

## üîç Filter Types

### Basic Filter Input

Each model gets a comprehensive filter input type.

```graphql
input <Model>FilterInput {
  # Basic field filters
  <field>: <FieldType>
  <field>__exact: <FieldType>
  <field>__iexact: <FieldType>  # Case-insensitive
  
  # String field filters
  <stringField>__contains: String
  <stringField>__icontains: String
  <stringField>__startswith: String
  <stringField>__endswith: String
  <stringField>__regex: String
  
  # Numeric field filters
  <numericField>__gt: <NumericType>
  <numericField>__gte: <NumericType>
  <numericField>__lt: <NumericType>
  <numericField>__lte: <NumericType>
  <numericField>__range: [<NumericType>]
  
  # List filters
  <field>__in: [<FieldType>]
  <field>__isnull: Boolean
  
  # Relationship filters
  <foreignKey>: <RelatedModel>FilterInput
  <foreignKey>__<relatedField>: <RelatedFieldType>
  
  # Logical operators
  AND: [<Model>FilterInput]
  OR: [<Model>FilterInput]
  NOT: <Model>FilterInput
}
```

### Filter Examples

```graphql
# Complex filtering example
{
  "filters": {
    "OR": [
      {
        "title__icontains": "django",
        "published": true
      },
      {
        "author__username": "admin",
        "createdAt__gte": "2024-01-01T00:00:00Z"
      }
    ],
    "NOT": {
      "tags__name__in": ["deprecated", "archived"]
    }
  }
}
```

## üî¢ Scalar Types

### Built-in Scalars

The library uses standard GraphQL scalars and Django-specific ones.

```graphql
scalar ID
scalar String
scalar Int
scalar Float
scalar Boolean
scalar DateTime  # ISO 8601 datetime string
scalar Date      # ISO 8601 date string
scalar Time      # ISO 8601 time string
scalar Decimal   # Decimal number as string
scalar JSON      # JSON object/array
scalar UUID      # UUID string
```

### Custom Scalars

Additional scalars for Django field types.

```graphql
scalar Upload    # File upload
scalar Email     # Email address
scalar URL       # URL string
scalar Slug      # URL-safe slug
scalar Duration  # ISO 8601 duration
```

## ‚ö†Ô∏è Error Handling

### Error Response Format

All mutations return errors in a consistent format.

```json
{
  "data": {
    "createPost": {
      "ok": false,
      "post": null,
      "errors": [
        "Title is required",
        "Author with ID 999 does not exist",
        "Content cannot be empty"
      ]
    }
  }
}
```

### Error Types

| Error Type | Description | Example |
|------------|-------------|---------|
| **Validation Error** | Field validation failed | "Title cannot be empty" |
| **Not Found Error** | Referenced object not found | "Author with ID 999 does not exist" |
| **Permission Error** | User lacks required permissions | "You don't have permission to create posts" |
| **Constraint Error** | Database constraint violation | "Post with this title already exists" |
| **Method Error** | Custom method execution failed | "Cannot publish post in draft status" |

### Partial Success (Bulk Operations)

Bulk operations support partial success where some objects succeed while others fail.

```json
{
  "data": {
    "bulkCreatePost": {
      "ok": false,
      "objects": [
        {
          "id": "1",
          "title": "Successfully Created Post"
        },
        null,  // Failed to create
        {
          "id": "2",
          "title": "Another Successful Post"
        }
      ],
      "errors": [
        "Object 2: Title is required"
      ]
    }
  }
}
```

## üìã Examples

### Complete CRUD Example

```graphql
# Create a post
mutation CreatePost {
  createPost(input: {
    title: "Getting Started with GraphQL"
    content: "GraphQL is a query language..."
    published: false
    authorId: "1"
    tagIds: ["1", "2"]
  }) {
    ok
    post {
      id
      title
      author { username }
      tags { name }
    }
    errors
  }
}

# Query posts with filtering
query GetPosts {
  posts(
    filters: {
      published: true
      author__username: "john_doe"
      createdAt__gte: "2024-01-01T00:00:00Z"
    }
    orderBy: ["-createdAt"]
    limit: 10
  ) {
    id
    title
    createdAt
    author {
      username
      email
    }
  }
}

# Update a post
mutation UpdatePost {
  updatePost(input: {
    id: "1"
    title: "Updated: Getting Started with GraphQL"
    published: true
  }) {
    ok
    post {
      id
      title
      published
      updatedAt
    }
    errors
  }
}

# Delete a post
mutation DeletePost {
  deletePost(id: "1") {
    ok
    deletedId
    errors
  }
}
```

### Advanced Filtering Example

```graphql
query AdvancedPostSearch {
  posts(filters: {
    OR: [
      {
        title__icontains: "tutorial"
        published: true
      },
      {
        author__username__in: ["admin", "editor"]
        tags__name: "featured"
      }
    ],
    NOT: {
      title__startswith: "Draft:"
    },
    createdAt__range: ["2024-01-01T00:00:00Z", "2024-12-31T23:59:59Z"]
  }) {
    id
    title
    author { username }
    tags { name }
    createdAt
  }
}
```

### Bulk Operations Example

```graphql
# Bulk create multiple posts
mutation BulkCreatePosts {
  bulkCreatePost(input: {
    objects: [
      {
        title: "Post 1"
        content: "Content 1..."
        authorId: "1"
      },
      {
        title: "Post 2"
        content: "Content 2..."
        authorId: "2"
      }
    ]
  }) {
    ok
    objects {
      id
      title
      author { username }
    }
    errors
  }
}

# Bulk update posts
mutation BulkUpdatePosts {
  bulkUpdatePost(input: {
    objects: [
      { id: "1", published: true },
      { id: "2", published: true },
      { id: "3", title: "Updated Title" }
    ]
  }) {
    ok
    objects {
      id
      title
      published
    }
    errors
  }
}
```

### Method Mutations Example

```graphql
# Execute custom model methods
mutation PublishPost {
  postPublishPost(id: "1") {
    ok
    post {
      id
      title
      published
      publishedAt
    }
    result  # Method return value
    errors
  }
}

mutation ArchivePost {
  postArchivePost(id: "1", reason: "Content outdated") {
    ok
    post {
      id
      title
      archived
      archiveReason
    }
    result
    errors
  }
}
```

This comprehensive API reference covers all aspects of the generated GraphQL schema. The library automatically creates consistent, powerful APIs from your Django models with minimal configuration required.